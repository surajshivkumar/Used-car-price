{% extends "base.html" %} {% block title %}Home{% endblock %} {% block content
%}
<div class="top-section overflow-hidden">
  <div
    class="container h-full flex items-center justify-center lg:pt-24 pt-12 lg:pb-32 pb-16"
  >
    <div class="lg:w-7/12 w-full">
      <h1 class="mb-3">
        See what your <span class="text-orange-600">car is worth</span>
      </h1>
      <p class="mb-5 text-slate-500">
        Get an instant appraisal in as little as 2 minutes.
      </p>
    </div>
    <div class="lg:w-5/12 w-full flex items-center justify-center">
      <form id="detailsForm" action="/sell" method="post" class="hidden">
        <input type="hidden" name="action" value="getCarMake" />
        <input id="getCarMake" type="text" name="carMake" value="" />
        <input id="getCarModel" type="text" name="carModel" value="" />
      </form>

      <form
        action="/sell"
        method="post"
        class="shadow-lg bg-white p-6 rounded-xl w-full"
        id="form"
      >
        <p class="lg:pb-4 pb-2 font-semibold">
          Please fill in the form to get a quote
        </p>
        <input type="hidden" name="action" value="getCarPrice" />
        <div class="grid grid-cols-1 gap-4">
          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carType">Car Type</label>
            <select
              required
              id="carType"
              name="carType"
              class="border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            >
              <option value="" disabled selected>Please select</option>
              {% for car in car_types %}
              <option value="{{ car }}">{{ car }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carMake">Car Make</label>
            <select
              id="carMake"
              name="carMake"
              disabled
              class="border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            >
              <option value="" disabled selected>
                Please select a car type first
              </option>
              {% for make in car_make %}
              <option value="{{ make }}">{{ make }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carModel">Car Model</label>
            <select
              id="carModel"
              name="carModel"
              disabled
              class="border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            >
              <option value="" disabled selected>
                Please select a car make first
              </option>
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carMileage">Car Mileage</label>
            <input
              type="text"
              name="carMileage"
              id="carMileage"
              placeholder="Enter Mileage"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            />
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carColor">Car Color</label>
            <input
              type="text"
              name="carColor"
              id="carColor"
              placeholder="Enter Color"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            />
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carYear">Car Year</label>
            <input
              type="number"
              name="carYear"
              id="carYear"
              placeholder="Enter Year"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-orange-600 focus-visible:outline-orange-600 hover:border-orange-600 h-9"
            />
          </div>
        </div>
        <div class="flex justify-end lg:pt-10 pt-5">
          <button
            type="submit"
            class="text-center py-2 lg:px-5 px-3 transition lg:text-lg text-base font-semibold rounded-lg bg-cyan-400 hover:bg-cyan-600 text-white"
          >
            Get Quote
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div
  id="price-section"
  class="hidden lg:py-24 py-12 w-full bg-orange-gradient h-[600px]"
>
  <div id="loading" class="flex flex-col items-center">
    <img src="../static/assets/loading.gif" alt="gif" class="w-64 h-48" />
    <h4 class="pt-2 ml-8">Loading...</h4>
  </div>

  <h2 id="price" class="hidden">The price is {{carPrice}}</h2>
</div>

<script>
  let carTypeSelect = document.getElementById("carType");
  let carMakeSelect = document.getElementById("carMake");
  let carModelSelect = document.getElementById("carModel");

  let selectedCarType;

  document.addEventListener("DOMContentLoaded", function () {
    formSubmitListener();
  });
  carTypeSelectListener();
  carMakeSelectListener();

  function formSubmitListener() {
    const form = document.getElementById("form");
    if (form) {
      form.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission
        const formData = new FormData(form);
        fetch("/sell", {
          method: "POST",
          body: formData, // You can pass the form data
        })
          .then((response) => response.json()) // Parse the JSON response
          .then((data) => {
            console.log(data);
            let carPrice = data.price;

            if (carPrice) {
              let priceSection = document.getElementById("price-section");
              priceSection.classList.add("flex");
              priceSection.classList.add("justify-center");
              priceSection.classList.add("items-center");
              priceSection.classList.add("flex-col");
              priceSection.classList.remove("hidden");

              priceSection.scrollIntoView({
                behavior: "smooth", // You can use 'auto' for an instant scroll
                block: "start", // You can use 'center' or 'end' for different positions
              });

              setTimeout(() => {
                let price = document.getElementById("price");
                let loading = document.getElementById("loading");
                price.classList.remove("hidden");
                loading.classList.add("hidden");
              }, 3500);
            }
          });
      });
    }
  }
  function carTypeSelectListener() {
    // Event listener for carTypeSelect
    carTypeSelect.addEventListener("change", function () {
      selectedCarType = carTypeSelect.value;

      // Clear and disable the carMakeSelect
      carMakeSelect.innerHTML = "";
      carMakeSelect.disabled = true;

      if (selectedCarType) {
        // Fetch car models from the backend based on the selected car type
        const formData = new FormData();
        formData.append("action", "getCarMake");
        formData.append("carType", selectedCarType);
        fetch("/sell", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json()) // Parse the JSON response
          .then((data) => {
            console.log(data);
            let placeholderOption = document.createElement("option");
            placeholderOption.value = "";
            placeholderOption.textContent = "Please select";
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            carMakeSelect.appendChild(placeholderOption);

            data.forEach(function (carMake) {
              let option = document.createElement("option");
              option.value = carMake;
              option.textContent = carMake;
              carMakeSelect.appendChild(option);
            });

            carMakeSelect.disabled = false;
          })
          .catch((error) => console.error(error));
      } else {
        let placeholderOption = document.createElement("option");
        placeholderOption.value = "";
        placeholderOption.textContent = "Please select a car type first";
        carMakeSelect.appendChild(placeholderOption);
      }
    });
  }
  function carMakeSelectListener() {
    carMakeSelect.addEventListener("change", function () {
      let selectedCarMake = carMakeSelect.value;

      // Clear and disable the carMakeSelect
      carModelSelect.innerHTML = "";
      carModelSelect.disabled = true;

      if (selectedCarMake) {
        // Fetch car models from the backend based on the selected car make
        const formData = new FormData();
        formData.append("action", "getCarModel");
        formData.append("carType", selectedCarType);
        formData.append("carMake", selectedCarMake);
        fetch("/sell", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json()) // Parse the JSON response
          .then((data) => {
            let placeholderOption = document.createElement("option");
            placeholderOption.value = "";
            placeholderOption.textContent = "Please select";
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            carModelSelect.appendChild(placeholderOption);

            data.forEach(function (carMake) {
              let option = document.createElement("option");
              option.value = carMake;
              option.textContent = carMake;
              carModelSelect.appendChild(option);
            });

            carModelSelect.disabled = false;
          })
          .catch((error) => console.error(error));
      } else {
        let placeholderOption = document.createElement("option");
        placeholderOption.value = "";
        placeholderOption.textContent = "Please select a car make first";
        carModelSelect.appendChild(placeholderOption);
      }
    });
  }
</script>

<style>
  .top-section {
    position: relative;
  }
  .top-section::before {
    position: absolute;
    right: -10%;
    top: -35%;
    z-index: -1;
    height: 800px;
    width: 800px;
    border-radius: 9999px;
    --tw-content: "";
    content: var(--tw-content);
    background: linear-gradient(
      200deg,
      rgb(247, 240, 237) 40%,
      rgb(241, 246, 245) 100%
    );
  }
</style>
{% endblock %}
