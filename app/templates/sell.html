{% extends "base.html" %} {% block title %}Sell{% endblock %} {% block content
%}
<div class="top-section overflow-hidden min-h-[calc(100vh-136px)]">
  <div class="container h-full lg:py-24 py-12 lg:gap-12 gap-6">
    <div class="flex flex-col justify-center">
      <h1 class="text-center mb-3">
        See what your <span class="text-orange-600">car is worth</span>
      </h1>
      <p class="text-center mb-5 text-slate-500">
        Get an instant appraisal in as little as 2 minutes.
      </p>
    </div>
    <div class="flex items-center justify-center lg:pt-6 pt-3">
      <form id="detailsForm" action="/sell" method="post" class="hidden">
        <input type="hidden" name="action" value="getCarMake" />
        <input id="getCarMake" type="text" name="carMake" value="" />
        <input id="getCarModel" type="text" name="carModel" value="" />
      </form>

      <form
        action="/sell"
        method="post"
        class="bg-shadow bg-white p-6 rounded-xl w-full"
        id="form"
      >
        <!-- <p class="lg:pb-4 pb-2 font-semibold">
          Please fill in the form to get a quote
        </p> -->
        <input type="hidden" name="action" value="getCarPrice" />
        <div class="grid grid-cols-3 gap-4">
          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carType">Car Type</label>
            <select
              required
              id="carType"
              name="carType"
              class="border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            >
              <option value="" disabled selected>Please select</option>
              {% for car in carTypes %}
              <option value="{{ car }}">{{ car }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carMake">Car Make</label>
            <select
              id="carMake"
              name="carMake"
              disabled
              class="border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            >
              <option value="" disabled selected>
                Please select a car type first
              </option>
              {% for make in car_make %}
              <option value="{{ make }}">{{ make }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carModel">Car Model</label>
            <select
              id="carModel"
              name="carModel"
              disabled
              class="border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            >
              <option value="" disabled selected>
                Please select a car make first
              </option>
            </select>
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carMileage">Car Mileage</label>
            <input
              type="text"
              name="carMileage"
              id="carMileage"
              placeholder="Enter Mileage"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            />
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carColor">Car Color</label>
            <input
              type="text"
              name="carColor"
              id="carColor"
              placeholder="Enter Color"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            />
          </div>

          <div class="flex flex-col">
            <label class="text-sm pb-1" for="carYear">Car Year</label>
            <input
              type="number"
              name="carYear"
              id="carYear"
              placeholder="Enter Year"
              class="px-2 border border-gray-100 bg-gray-100 rounded focus:!border-cyan-400 focus-visible:outline-cyan-400 hover:border-cyan-400 h-9"
            />
          </div>
        </div>

        <button
          class="pt-4 hover:text-cyan-400"
          onclick="toggleAdvancedSettings()"
        >
          Show Advanced Settings
        </button>
        <div class="hidden flex-wrap gap-4 pt-2" id="advanced-settings">
          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Hill Assist System</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Entry</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Multimedia Telematics</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Hill Assist System</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Hill Assist System</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Multimedia Telematics</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Entry</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Full Self Driving Capability</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Multimedia Telematics</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Entry</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Hill Assist System</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Entry</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="flex flex-col gap-1 min-w-[150px]">
            <p class="text-xs">Keyless Ignition</p>
            <label class="switch">
              <input type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="flex justify-end lg:pt-10 pt-5">
          <button
            type="submit"
            class="whitespace-nowrap border-none text-center py-2 lg:px-5 px-3 transition lg:text-lg text-base font-semibold rounded-lg bg-cyan-400 hover:bg-cyan-600 text-white"
          >
            Get Quote
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- <div class="bg-orange-gradient lg:py-24 py-12">
  <div class="container">
    <p class="font-semibold text-center">PRICE BREAKDOWN</p>
    <p class="text-center pt-2">
      This analysis is based on a comparison of 28 vehicles with similar
      features and mileage in your local area.
    </p>
    <div>
      <div id="deal-header" class="grid grid-cols-4 text-center lg:pt-12 pt-6">
        <div class="great"></div>
        <div class="good"></div>
        <div class="fair"></div>
        <div class="above"></div>
      </div>
      <div id="deal-main" class="grid grid-cols-4 -mt-7">
        <div class="great pt-4 text-center relative">
          <div class="w-full h-2 bg-gray-300 rounded-l-lg"></div>
          <p class="pt-4 lg:text-sm text-xs font-semibold text-gray-500">
            GREAT DEAL
          </p>
        </div>
        <div class="good pt-4 text-center relative">
          <div class="w-full h-2 bg-gray-300"></div>
          <p class="pt-4 lg:text-sm text-xs font-semibold text-gray-500">
            GOOD DEAL
          </p>
        </div>
        <div class="fair pt-4 text-center relative">
          <div class="w-full h-2 bg-gray-300"></div>
          <p class="pt-4 lg:text-sm text-xs font-semibold text-gray-500">
            FAIR PRICE
          </p>
        </div>
        <div class="above pt-4 text-center relative">
          <div class="w-full h-2 bg-gray-300 rounded-r-lg"></div>
          <p class="pt-4 lg:text-sm text-xs font-semibold text-gray-500">
            ABOVE MARKET
          </p>
        </div>
      </div>
    </div>
  </div>
</div> -->

<!-- <div class="bg-blue-300 text-blue-300 text-green-300 bg-green-300 text-yellow-300 bg-yellow-300 bg-red-300 text-red-300"></div> -->

<div id="price-section" class="hidden lg:py-24 py-12 w-full h-[600px]">
  <div id="loading" class="flex flex-col items-center">
    <img
      data-src="https://storage.googleapis.com/cdn-cloudstore/loading.gif"
      alt="gif"
      class="lazy-image w-64 h-48"
    />
    <h4 class="pt-2 ml-8">Loading...</h4>
  </div>

  <h2 id="price" class="hidden">The price is {{carPrice}}</h2>
</div>
<script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>
<link
  rel="stylesheet"
  href="https://unpkg.com/slim-select@latest/dist/slimselect.css"
/>
<script>
  const dealType = "above";
  const dealMap = {
    great: {
      color: "blue",
    },
    good: {
      color: "green",
    },
    fair: {
      color: "yellow",
    },
    above: {
      color: "red",
    },
  };

  let carTypeSelect = document.getElementById("carType");
  let carMakeSelect = document.getElementById("carMake");
  let carModelSelect = document.getElementById("carModel");
  let dealHeaderDiv = document.getElementById("deal-header");
  let dealMainDiv = document.getElementById("deal-main");
  let advancedSettingsDiv = document.getElementById("advanced-settings");

  let slimSelectType = new SlimSelect({
    select: carTypeSelect,
  });
  let slimSelectMake = new SlimSelect({
    select: carMakeSelect,
  });
  let slimSelectModel = new SlimSelect({
    select: carModelSelect,
  });

  let selectedCarType;
  let selectedCarMake;
  let selectedCarModel;
  carModelSelect.addEventListener("change", function () {
    selectedCarModel = carModelSelect.value;
  });

  document.addEventListener("DOMContentLoaded", function () {
    formSubmitListener();
  });

  onSelectChange(carTypeSelect, "getCarMake");
  onSelectChange(carMakeSelect, "getCarModel");

  setDealsDetails(dealType);

  function setDealsDetails(dealType) {
    setDealHeader(dealType, 70000);
    setDealMain(dealType);
  }

  function formSubmitListener() {
    const form = document.getElementById("form");
    if (form) {
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const formData = new FormData(form);
        fetch("/sell", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.price) {
              let priceSection = document.getElementById("price-section");
              priceSection.classList.add("flex");
              priceSection.classList.add("justify-center");
              priceSection.classList.add("items-center");
              priceSection.classList.add("flex-col");
              priceSection.classList.remove("hidden");

              priceSection.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });

              setTimeout(() => {
                let price = document.getElementById("price");
                let loading = document.getElementById("loading");
                price.classList.remove("hidden");
                loading.classList.add("hidden");
              }, 3500);
            }
          });
      });
    }
  }

  function onSelectChange(typeChanged, action) {
    typeChanged.addEventListener("change", function () {
      let selectedValue = typeChanged.value;
      let nextSelect =
        action === "getCarMake" ? slimSelectMake : slimSelectModel;

      nextSelect.innerHTML = "";
      resetSelect(nextSelect);
      nextSelect.disable();
      let payload = {};
      if (action === "getCarMake") {
        selectedCarType = selectedValue;
        carModelSelect.innerHTML = "";
        // resetSelect(slimSelectModel);
      }
      if (action === "getCarModel") {
        payload["carMake"] = selectedValue;
      }
      payload["carType"] = selectedCarType;

      if (selectedValue) {
        const formData = new FormData();
        formData.append("action", action);
        formData.append("carType", payload.carType);
        if (action === "getCarModel") {
          formData.append("carMake", payload.carMake);
        }
        fetch("/sell", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            let tempArr = [];
            let placeholder = document.createElement("option");
            placeholder.value = "";
            placeholder.textContent = "Please select";
            placeholder.disabled = true;
            placeholder.selected = true;
            tempArr.push(placeholder);

            data.forEach((ele) => {
              let option = document.createElement("option");
              option.value = ele;
              option.textContent = toTitleCase(ele);
              tempArr.push(option);
            });
            nextSelect.setData(tempArr);
            nextSelect.enable();
          })
          .catch((error) => console.error(error));
      }
    });
  }

  function resetSelect(slimSelect) {
    let placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "Please select a car type first";
    slimSelect.setData(placeholder);
  }

  function toTitleCase(inputString) {
    const words = inputString.split(" ");
    const titleCaseWords = words.map((word) => {
      if (word.length === 0) {
        return ""; // Handle empty words (e.g., multiple spaces)
      }
      return word[0].toUpperCase() + word.slice(1).toLowerCase();
    });
    return titleCaseWords.join(" ");
  }

  function setDealMain(type) {
    const parentDiv = dealMainDiv.querySelector(`.${type}`);
    if (parentDiv) {
      const childDiv = parentDiv.querySelector("div");
      childDiv.classList.remove("bg-gray-300");
      childDiv.classList.add(`bg-${dealMap[type].color}-300`);
      const pElement = parentDiv.querySelector("p");
      pElement.classList.remove("text-gray-500");
      pElement.classList.add(`text-${dealMap[type].color}-300`);
    }
  }
  function setDealHeader(type, price) {
    const parentDiv = dealHeaderDiv.querySelector(`.${type}`);
    if (parentDiv) {
      const pElement1 = document.createElement("p");
      pElement1.classList.add("font-semibold", "lg:text-sm", "text-xs");
      pElement1.textContent = "THIS VEHICLE";

      const pElement2 = document.createElement("p");
      pElement2.classList.add(
        "lg:text-base",
        "text-sm",
        "font-semibold",
        "pb-2"
      );
      pElement2.textContent = `$${price}`;

      const circleDiv = document.createElement("div");
      circleDiv.classList.add(
        "bg-white",
        `shadow-${dealMap[type].color}`,
        "rounded-full",
        "w-4",
        "h-4",
        "mx-auto",
        "z-10",
        "relative"
      );

      parentDiv.appendChild(pElement1);
      parentDiv.appendChild(pElement2);
      parentDiv.appendChild(circleDiv);
    }
  }

  function toggleAdvancedSettings() {
    if (advancedSettingsDiv.classList.contains("hidden")) {
      advancedSettingsDiv.classList.remove("hidden");
      advancedSettingsDiv.classList.add("flex");
      return;
    }

    advancedSettingsDiv.classList.remove("flex");
    advancedSettingsDiv.classList.add("hidden");
  }
</script>

<style>
  .top-section {
    position: relative;
  }
  @media (min-width: 1024px) {
    .top-section::before {
      position: absolute;
      right: -10%;
      top: -35%;
      z-index: -1;
      height: 800px;
      width: 800px;
      border-radius: 9999px;
      --tw-content: "";
      content: var(--tw-content);
      background: linear-gradient(
        200deg,
        rgb(247, 240, 237) 40%,
        rgb(241, 246, 245) 100%
      );
    }
  }
  .shadow-blue {
    box-shadow:
      0 0 0 4px #93c5fdb0,
      0 0 0 8px #93c5fd80;
  }

  .shadow-green {
    box-shadow:
      0 0 0 4px #35d0b1b0,
      0 0 0 8px #35d0b180;
  }

  .shadow-yellow {
    box-shadow:
      0 0 0 4px #fde047b0,
      0 0 0 8px #fde04780;
  }

  .shadow-red {
    box-shadow:
      0 0 0 4px #fca5a5b0,
      0 0 0 8px #fca5a580;
  }

  .switch {
    --button-width: 3.5em;
    --button-height: 2em;
    --toggle-diameter: 1.5em;
    --button-toggle-offset: calc(
      (var(--button-height) - var(--toggle-diameter)) / 2
    );
    --toggle-shadow-offset: 10px;
    --toggle-wider: 3em;
    --color-grey: #cccccc;
    --color-green: #4296f4;
  }

  .slider {
    display: inline-block;
    width: var(--button-width);
    height: var(--button-height);
    background-color: var(--color-grey);
    border-radius: calc(var(--button-height) / 2);
    position: relative;
    transition: 0.3s all ease-in-out;
  }

  .slider::after {
    content: "";
    display: inline-block;
    width: var(--toggle-diameter);
    height: var(--toggle-diameter);
    background-color: #fff;
    border-radius: calc(var(--toggle-diameter) / 2);
    position: absolute;
    top: var(--button-toggle-offset);
    transform: translateX(var(--button-toggle-offset));
    box-shadow: var(--toggle-shadow-offset) 0
      calc(var(--toggle-shadow-offset) * 4) rgba(0, 0, 0, 0.1);
    transition: 0.3s all ease-in-out;
  }

  .switch input[type="checkbox"]:checked + .slider {
    background-color: var(--color-green);
  }

  .switch input[type="checkbox"]:checked + .slider::after {
    transform: translateX(
      calc(
        var(--button-width) - var(--toggle-diameter) -
          var(--button-toggle-offset)
      )
    );
    box-shadow: calc(var(--toggle-shadow-offset) * -1) 0
      calc(var(--toggle-shadow-offset) * 4) rgba(0, 0, 0, 0.1);
  }

  .switch input[type="checkbox"] {
    display: none;
  }

  .switch input[type="checkbox"]:active + .slider::after {
    width: var(--toggle-wider);
  }

  .switch input[type="checkbox"]:checked:active + .slider::after {
    transform: translateX(
      calc(
        var(--button-width) - var(--toggle-wider) - var(--button-toggle-offset)
      )
    );
  }
</style>
{% endblock %}
