{% extends "base.html" %} {% block title %}Results{% endblock %} {% block
content %}
<div
  class="w-full lg:px-4 lg:pt-2 pt-2 lg:pb-6 pb-3 sticky top-16 bg-white border-b border-b-gray-300"
>
  <p class="pl-2">Search</p>
  <div class="autoComplete_wrapper w-full pt-2">
    <form class="w-full" action="/results" method="POST" id="myForm">
      <input
        class="!w-full"
        id="autoComplete"
        type="search"
        dir="ltr"
        spellcheck="false"
        autocorrect="off"
        autocomplete="off"
        autocapitalize="off"
        name="search-term"
        value=""
      />
      <input type="hidden" name="type" value="search" />
    </form>
  </div>
</div>
<div class="flex h-full">
  <div class="xl:w-2/12 w-3/12 bg-gray-100 border-r border-r-gray-300 h-auto">
    <div class="border-l border-b border-gray-300">
      <div class="shadow border-b border-b-gray-300 px-2 w-full py-4 bg-white">
        <p class="font-semibold">MILAGE</p>
      </div>
      <div class="flex justify-between items-center gap-2 p-2 pb-4">
        <div>
          <p class="text-sm">Min Miles</p>
          <input
            class="border border-gray-400 rounded p-2 w-full"
            type="number"
            placeholder="min"
          />
        </div>
        <div>-</div>
        <div>
          <p class="text-sm">Max Miles</p>
          <input
            class="border border-gray-400 rounded p-2 w-full"
            type="number"
            placeholder="max"
          />
        </div>
      </div>
    </div>
  </div>
  <div class="xl:w-10/12 w-9/12 p-4">
    <p>Showing results for {{searchTerm}}</p>
    <form action="/results-view" method="POST" id="hiddenForm">
      <input type="hidden" id="product-id" name="productId" value="" />
    </form>
    <div
      class="grid xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-2 grid-cols-1 lg:gap-6 gap-3 lg:pt-12 pt-6"
    >
      {% for car in results %}
      <a
        class="shadow-md rounded-md hover:shadow-lg hover:scale-105 transition-transform cursor-pointer"
        href="javascript:void(0);"
        onclick="submitForm('{{ car.product_id }}')"
      >
        <img
          src="https://storage.googleapis.com/cdn-cloudstore/results/{{car.path}}"
          alt=""
          class="w-full h-48 rounded-t-md object-cover aspect-[3/2]"
        />
        <div class="flex justify-between lg:p-4 p-2">
          <div>
            <h5 class="font-semibold text-center">{{car.year}}</h5>
            <h5 class="font-semibold text-center">{{car.name}}</h5>
          </div>
          <h5 class="font-semibold">${{car.price}}</h5>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  let allCarsList = {{allCars|tojson}};

  const autoCompleteJS = new autoComplete({
    selector: "#autoComplete",
    placeHolder: "Search for Cars...",
    searchEngine: "strict",
    threshold: 2,
    data: {
      src: allCarsList,
      cache: true,
    },
    resultsList: {
      element: (list, data) => {
        if (!data.results.length) {
          const message = document.createElement("div");
          message.setAttribute("class", "no_result");
          message.innerHTML = `<span>Found No Results for "${data.query}"</span>`;
          list.prepend(message);
        }
      },
      noResults: true,
    },
    resultItem: {
      highlight: true,
    },
    events: {
      input: {
        selection: (event) => {
          console.log("HELLO");
          const selection = event.detail.selection.value;
          autoCompleteJS.input.value = selection;
          document.getElementById("myForm").submit();
        },
      },
    },
  });

  function submitForm(productId) {
    document.getElementById("product-id").value = productId;
    document.getElementById("hiddenForm").submit();
  }
</script>
<style>
  .shadow {
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.15);
  }
</style>
{% endblock %}
